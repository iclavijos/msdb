<section class="content">
    <div class="container-fluid">
        <div class="block-header mt-n3">
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                    <ul class="breadcrumb breadcrumb-style ">
                        <li class="breadcrumb-item bcrumb-2">
                            <a routerLink="/"><fa-icon [icon]="['fas', 'arrow-alt-circle-right']" size="2x"></fa-icon></a>
                        </li>
                        <li class="breadcrumb-item bcrumb-2">
                            <a routerLink="/event">{{ 'motorsportsDatabaseApp.event.home.title' | translate }}</a>
                        </li>
                        <li class="breadcrumb-item bcrumb-3">
                            <a [routerLink]="['/event', eventEdition!.event!.id ]">{{ eventEdition!.event!.name }}</a>
                        </li>
                        <li class="breadcrumb-item active">{{ eventEdition!.longEventName }}</li>
                    </ul>
                </div>
            </div>
        </div>
        <jhi-alert-error></jhi-alert-error>
        <jhi-alert></jhi-alert>
        <div class="row clearfix">
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                <div class="card">
                    <mat-tab-group dynamicHeight mat-stretch-tabs [(selectedIndex)]="index">
                        <mat-tab label="{{'motorsportsDatabaseApp.eventEdition.info' | translate }}">
                            <div class="card">
                                <div [ngClass]="{
                                        'header' : true,
                                        'bg-yellow': eventEdition!.status === 'SUSPENDED',
                                        'bg-red': eventEdition!.status === 'CANCELLED'
                                     }"
                                     *ngIf="eventEdition!.status === 'SUSPENDED' || eventEdition!.status === 'CANCELLED'">
                                    <h2>{{ 'motorsportsDatabaseApp.eventEdition.status.' + eventEdition!.status!.toLowerCase() | translate }}</h2>
                                </div>
                                <div class="body">
                                    <div class="row">
                                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                                            <div class="row">
                                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                                                    <h5>{{ 'motorsportsDatabaseApp.eventEdition.allowedCategories' | translate }}</h5>
                                                    <ul class="list-unstyled">
                                                        <li *ngFor="let category of eventEdition!.allowedCategories">
                                                            <span>{{category.name}} ({{category.shortname}})</span>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                                                    <h5 *ngIf="!isRally() && !isRaid()">{{ eventEdition!.trackLayout?.racetrack!.name }}</h5>
                                                    <h5 *ngIf="isRally()">{{ 'motorsportsDatabaseApp.eventEdition.location' | translate }}</h5>
                                                    <h6 *ngIf="!isRally() && !isRaid()">{{ eventEdition!.trackLayout?.name }}</h6>
                                                    <h6 *ngIf="isRally()">{{ eventEdition!.location }}</h6>
                                                    <jhi-popup-image *ngIf="eventEdition?.trackLayout?.layoutImageUrl"
                                                                     [imageUrl]="eventEdition!.trackLayout!.layoutImageUrl!"
                                                                     imageAlt="layout image">
                                                    </jhi-popup-image>
                                                </div>
                                                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                                                    <h6>{{ 'motorsportsDatabaseApp.eventEdition.affiche' | translate }}</h6>
                                                    <jhi-popup-image
                                                        [imageUrl]="eventEdition!.posterUrl!"
                                                        imageAlt="affiche image">
                                                    </jhi-popup-image>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                                            <h5>{{ 'motorsportsDatabaseApp.eventEdition.sessions' | translate }}</h5>
                                            <jhi-event-session
                                                [eventEdition]="eventEdition!"
                                                (showPoints)="updateShowPoints($event)"
                                                (sessions)="updateSessions($event)">
                                            </jhi-event-session>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </mat-tab>
                        <mat-tab label="{{'motorsportsDatabaseApp.eventEdition.entryList' | translate }}">
                            <div>
                                <jhi-event-entry [eventEdition]="eventEdition!" (entries)="updateEntries($event)"></jhi-event-entry>
                            </div>
                        </mat-tab>
                        <mat-tab label="{{'motorsportsDatabaseApp.eventEdition.results' | translate }}">
                            <div>
                                <mat-tab-group dynamicHeight mat-stretch-tabs *ngIf="index == 2" [selectedIndex]="0">
                                    <mat-tab *ngFor="let eventSession of eventSessions" label="{{ eventSession.name }}">
                                        <ng-template matTabContent>
                                            <jhi-event-entry-result [eventSession]="eventSession" [eventEdition]="eventEdition!" [eventEntries]="eventEntries!">Result...</jhi-event-entry-result>
                                        </ng-template>
                                    </mat-tab>
                                </mat-tab-group>
                            </div>
                        </mat-tab>
                        <mat-tab label="{{'motorsportsDatabaseApp.eventEdition.driversTimes' | translate }}">
                            <div class="table-responsive">
                                <table mat-table class="table table-hover" [dataSource]="driversBestTimes">
                                    <ng-container *ngFor="let column of bestTimesColumns; let i = index" matColumnDef="{{ column }}">
                                        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
                                        <td mat-cell *matCellDef="let row">
                                            <div *ngIf="i === 0">
                                                {{  row[i] }}
                                            </div>
                                            <div *ngIf="i !== 0">
                                                {{  row[i] | timeMaskPipe }}
                                            </div>
                                        </td>
                                    </ng-container>
                                    <tr mat-header-row *matHeaderRowDef="bestTimesColumns; sticky: true"></tr>
                                    <tr mat-row *matRowDef="let row; columns: bestTimesColumns;"></tr>
                                </table>
                            </div>
                        </mat-tab>
                        <mat-tab *ngIf="hasLapsData" label="{{'motorsportsDatabaseApp.eventEdition.lapsAnalysis' | translate}}">
                            <ng-template matTabContent>
                                <!-- jhi-laps-analysis [eventEdition]="eventEdition" [eventSessions]="eventSessions"
                                    [eventEntries]="eventEntries">Laps analysis..</jhi-laps-analysis -->
                            </ng-template>
                        </mat-tab>
                        <mat-tab *ngIf="showPoints" label="{{'motorsportsDatabaseApp.eventEdition.points' | translate}}">
                            <div>
                                <!-- jhi-standings [eventEdition]="eventEdition">Standings...</jhi-standings -->
                            </div>
                        </mat-tab>
                    </mat-tab-group>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="main-content">
    <div class="container-fluid">
        <jhi-alert-error></jhi-alert-error>
        <jhi-alert></jhi-alert>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-danger">
                        <div class="row">
                            <div class="col-9">
                                <h3 class="card-title">{{eventEdition!.longEventName}}</h3>
                            </div>
                            <div class="col-md-auto">
                                <div class="row" *ngIf="editions.length > 1">
                                    <fa-icon *ngIf="previousEditionId >= 0" class="pointer" icon="angle-double-left" size="2x" (click)="gotoPrevious()"></fa-icon>
                                    <div class="select-year-panel">
                                        <mat-select id="yearSelect" (selectionChange)="jumpToEdition($event.value)">
                                            <mat-option></mat-option>
                                            <mat-option *ngFor="let edition of editions" [value]="edition.id">{{edition.editionYear}}</mat-option>
                                        </mat-select>
                                    </div>
                                    <fa-icon *ngIf="nextEditionId >= 0" class="pointer" icon="angle-double-right" size="2x" (click)="gotoNext()"></fa-icon>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-6 col-md-6">
                                <ng-template ngFor let-item [ngForOf]="eventEdition!.seriesEditions" let-currentIndex="index">
                                    <span class="pointer" [routerLink]="['/series/edition', item.id, 'view']">
                                        <fa-icon class="pointer" icon="angle-double-left"></fa-icon> {{ item.editionName }}
                                    </span>
                                </ng-template>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <div class="row" *ngIf="navigationIds !== null">
                                    <ng-template ngFor let-item [ngForOf]="navigationIds" let-currentIndex="index">
                                        <div class="col-md-auto" *ngIf="item.prevId">
                                            <span class="pointer" [routerLink]="['/event/edition', item.prevId, 'view-ed']">
                                                <fa-icon class="pointer" icon="angle-double-left"></fa-icon> {{ item.prevName }}
                                            </span>
                                        </div>
                                        <div class="col"></div>
                                        <div class="col-md-auto" *ngIf="item.nextId">
                                            <span class="pointer" [routerLink]="['/event/edition', item.nextId, 'view-ed']">
                                                {{item.nextName}}
                                                <fa-icon class="pointer" icon="angle-double-right"></fa-icon>
                                            </span>
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button mat-button type="button" *jhiHasAnyAuthority="['ROLE_ADMIN', 'ROLE_EDITOR']"
                (click)="editEdition()"
                class="btn btn-primary">
            <fa-icon [icon]="'pencil-alt'"></fa-icon>&nbsp;<span jhiTranslate="entity.action.edit"> Edit</span>
        </button>
        <button mat-button type="button" *jhiHasAnyAuthority="['ROLE_ADMIN', 'ROLE_EDITOR']"
                (click)="rescheduleEventDialog()"
                class="btn btn-primary">
            <fa-icon icon="calendar"></fa-icon> <span jhiTranslate="motorsportsDatabaseApp.eventEdition.reschedule.reschedule"> Reschedule</span>
        </button>
        <button mat-button *jhiHasAnyAuthority="['ROLE_ADMIN', 'ROLE_EDITOR']"
                class="btn btn-primary" (click)="copyEntries()">
            <fa-icon icon="clone"></fa-icon>&nbsp;<span class="hidden-sm-down"  jhiTranslate="motorsportsDatabaseApp.eventEdition.copyEntries.copyLabel">
            Clone entries
            </span>
        </button>
        <button mat-button type="button" *jhiHasAnyAuthority="['ROLE_ADMIN', 'ROLE_EDITOR']"
                class="btn btn-warning" (click)="cloneEvent()">
            <fa-icon [icon]="'clone'"></fa-icon> <span jhiTranslate="motorsportsDatabaseApp.eventEdition.clone.clone"> Clone</span>
        </button>
        <button type="submit"
                (click)="previousState()"
                class="btn btn-info">
            <fa-icon [icon]="'arrow-left'"></fa-icon>&nbsp;<span jhiTranslate="entity.action.back"> Back</span>
        </button>
    </div>
</div>
